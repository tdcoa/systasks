description: Generate vt_dbc_column_summary containing summary information on all columns in the database (from dbc.ColumnsV), including data types, column types, identity columns, formatted flags, as well as aggregated categories, along with column counts.  This is all summary only, and does NOT include column/table/database names.
version: 1
tasks:

{% include "vt_dbc_column_summary.j2" %}

- name: Export vt_dbc_column_summary for reconciliation
  connect: source
  export:
    file: dbc_column_summary.csv
    sql: Select * from vt_dbc_column_summary

- name: Export vt_dbc_column_summary for charting
  connect: source
  export:
    file: dbc_column_count_by_datatype.csv
    sql: |
      Select Column_Category as "Column Category"
      ,sum(Column_Count) as "Column Count"
      from vt_dbc_column_summary
      where Column_Count <>0
      group by 1 order by 2 desc

- name: Chart column counts by data type
  chart:
    command: chart/barline_xLabels_yBar_yLine.py
    params:
      - "file:dbc_column_count_by_datatype.csv"
      - "title:Column Counts by DataType - {{ siteid }}"
      - "height:6"
      - "width:18"
      - "xrotate:90"

- name: Chart column counts by data type, logscale
  chart:
    command: chart/barline_xLabels_yBar_yLine.py
    params:
      - "file:dbc_column_count_by_datatype.csv"
      - "title:Column Counts by DataType - {{ siteid }}"
      - "height:6"
      - "width:18"
      - "xrotate:90"
      - "barlogscale:True"
      - "pngfile:dbc_column_count_by_datatype_log.png"
