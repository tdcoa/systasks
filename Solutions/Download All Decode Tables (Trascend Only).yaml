description: >
     RUNNING AGAINST TRANSCEND ONLY, this process downloads all Decode_* datasets from the
     TD_Common_View database.  This is primarily used to re-generate Decode_*.csv files
     for pushing back out to the System Collection.zip release files.

version: 1
# add this line to skip duplicate CREATE vt_* statements :
{% set run = namespace(completed=[]) if run is not defined else run %}
{% set save_prework = true %}
{% set decode_from_transcend = true %}

tasks:


{% include "vt_decode_tablekind.j2" %}

- name: "Export vt_decode_tablekind.csv"
  connect: source
  export:
    file: decode_tablekind.csv
    sql: select * from vt_decode_tablekind order by 1


{% include "vt_decode_feature.j2" %}

- name: "Export vt_decode_feature.csv"
  connect: source
  export:
    file: decode_feature.csv
    sql: select * from vt_decode_feature


{% include "vt_decode_appid.j2" %}
- name: "Export vt_decode_appid_load.csv"
  connect: source
  export:
    file: decode_appid.csv
    sql: select * from vt_decode_appid_load order by Priority asc


{% include "vt_decode_statement.j2" %}
- name: "Export vt_decode_statement_load.csv"
  connect: source
  export:
    file: decode_statement.csv
    sql: select * from vt_decode_statement_load order by Statement_Use15


{% include "vt_decode_tdbinternal.j2" %}
- name: "Export vt_decode_tdbinternal_load.csv"
  connect: source
  export:
    file: decode_tdbinternal.csv
    sql: select * from vt_decode_tdbinternal_load order by DatabaseName


{% include "vt_decode_columntype.j2" %}
- name: "Export vt_decode_columntype.csv"
  connect: source
  export:
    file: decode_columntype.csv
    sql: select * from vt_decode_columntype


{% include "vt_decode_indextype.j2" %}
- name: "Export vt_decode_indextype.csv"
  connect: source
  export:
    file: decode_indextype.csv
    sql: select * from vt_decode_indextype


{% include "vt_decode_user.j2" %}
- name: "Update Stephen"
  connect: source
  execute:
    sql: |
      update vt_decode_user set
       FullName = 'Stephen Hilton'
      ,UserType = 'Analytic'
      ,Organization = 'Customer Success'
      ,Department = 'Global Strategy, Analytics, Automation'
      where UserName = 'sh186014'

- name: "Delete all TD-Specific Users"
  connect: source
  execute:
    sql: Delete from vt_decode_user where UserType like '%Unknown%'

- name: "Export vt_decode_user to decode_user.csv"
  connect: source
  export:
    file: decode_user.csv
    sql: select * from vt_decode_user order by Organization,Department,UserType


- name: "Fix CSV for BTEQ consumption"
  connect: source
  script:
    command: scripts/bteqfix_csv.py
    params:
      - decode_user.csv
      - decode_appid.csv
      - decode_feature.csv
